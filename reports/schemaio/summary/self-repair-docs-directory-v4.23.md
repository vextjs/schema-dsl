# 规范自我修复报告 - 目录查证流程缺失

> **触发时间**: 2025-12-24  
> **触发场景**: 用户询问"为什么没有docs目录"，AI未查证就直接创建  
> **规范版本**: AI开发规范 v4.23  
> **修复类型**: 细节缺失补充  

---

## 📋 问题识别

### 违规行为回顾

1. **用户询问**: "为什么没有docs目录存储文档呢？"
2. **AI错误行为**:
   - ❌ 立即创建 docs/ 目录
   - ❌ 差点移动设计文档到 docs/DESIGN.md
   - ❌ 未查证 docs/ 目录的实际用途
3. **用户制止**: "暂停，你先搞清楚docs目录是干嘛的？"
4. **用户要求**: "自我修复"

---

### 违反的规范

| 规范条目 | 具体内容 | 如何违反 |
|---------|---------|---------|
| 执行原则 #4 | 禁止猜测 | 未查证目录用途，凭"常识"认为docs/存文档 |
| 执行原则 #10 | 禁止直接执行 | 用户询问应先分析，但AI直接创建目录 |

---

## 🔍 规范问题分析

### 问题类型

**③ 细节缺失** - 规范说"禁止猜测"，但未明确"如何查证项目目录结构"

### 问题定位

**规范章节**: 1.3节 - 执行原则

**缺失内容**:
1. ❌ 未定义"创建项目目录前的查证流程"
2. ❌ 未说明"用户询问目录问题时的处理方式"
3. ❌ 未提供"查证目录用途的具体方法"

### 根本原因

**现有规范**:
```markdown
执行原则 #4: 禁止猜测
  你必须查证数据库字段/API/技术栈后才能使用
```

**问题**: 
- 只列举了"数据库字段/API/技术栈"
- 未涵盖"项目目录结构"
- 未提供查证方法（如参考其他项目）

---

## 🛠️ 修复方案

### 推荐方案：扩展"执行原则 #4: 禁止猜测"

#### 修改位置
**文件**: global-copilot-instructions  
**章节**: 1.3节 - 执行原则 #4

#### 修改内容

```markdown
执行原则 #4: 禁止猜测
  你必须查证数据库字段/API/技术栈后才能使用（详见1.12节）
  
  🔴 扩展：创建项目目录前的查证流程
  
  触发条件（满足任一即触发）:
    ✅ 用户询问"为什么没有XX目录"
    ✅ 你发现项目缺少某个常见目录（如docs/、examples/等）
    ✅ 用户要求创建新目录
  
  查证步骤（3步，必须执行）:
  
    步骤1 - 参考同类型成熟项目:
      你必须:
        1. 使用 list_dir 查看工作空间内其他项目的目录结构
        2. 重点查看同类型项目（如monSQLize也是库项目）
        3. 分析该目录内的文件类型和命名规律
        4. 判断目录的实际用途
      
      示例:
        用户问："为什么没有docs目录？"
        → list_dir("../monSQLize/docs")
        → 发现57个API文档（find.md, insert-one.md等）
        → 判断：docs/用于存放用户API文档，非设计文档
    
    步骤2 - 查阅项目文档:
      你必须:
        1. read_file 读取项目 README.md
        2. 查找是否有目录结构说明
        3. 如果有CONTRIBUTING.md，也读取检查
      
      示例:
        → read_file("README.md", 0, 100)
        → 查找"目录结构"、"Directory Structure"等关键词
    
    步骤3 - 分析并询问用户确认:
      你必须输出:
        ```
        🔍 目录用途分析
        
        参考项目: monSQLize/docs/
        发现内容: 57个API文档（find.md, aggregate.md等）
        
        判断: docs/目录用于存放：
        ✅ API参考文档
        ✅ 使用指南
        ✅ 功能教程
        ✅ 示例代码
        
        不应该放：
        ❌ 设计方案（应在plans/）
        ❌ 实施报告（应在reports/）
        
        建议结构:
        docs/
        ├── api/          # API文档
        ├── guides/       # 使用指南
        └── examples/     # 示例
        
        是否按此结构创建？[Y/N]
        ```
      
      等待用户确认后再创建
  
  违规行为识别:
    ❌ 错误示例1：直接创建
      用户: "为什么没有docs目录"
      AI: "好的，我来创建docs/目录..." ← 违规！未查证
    
    ❌ 错误示例2：凭常识判断
      AI: "docs/目录是存文档的，我来创建..." ← 违规！未查证实际用途
    
    ❌ 错误示例3：创建后移动文件
      AI: "我把设计文档移到docs/DESIGN.md..." ← 违规！混淆目录用途
    
    ✅ 正确示例：完整查证流程
      用户: "为什么没有docs目录"
      AI: "让我先查看其他项目的docs/目录用途..."
      AI: list_dir("../monSQLize/docs")
      AI: "发现monSQLize/docs/有57个API文档，判断docs/用于..."
      AI: "建议按此结构创建，是否确认？"
      用户: "确认"
      AI: 创建目录结构
```

#### 修改原因

1. **明确触发条件** - "用户询问目录问题"也需要查证
2. **提供具体流程** - 3步查证流程，可操作
3. **有正确示例** - 清楚展示如何正确执行
4. **有错误对比** - 帮助识别违规行为

---

## 📊 修复效果评估

### 预期效果

修复后，当用户询问"为什么没有XX目录"时：

**之前（违规）**:
```
用户: "为什么没有docs目录？"
AI: "好的，我来创建docs/目录"
AI: 创建 docs/
AI: 移动文件到 docs/DESIGN.md
用户: "暂停！你搞清楚docs是干嘛的吗？"
```

**之后（正确）**:
```
用户: "为什么没有docs目录？"
AI: "让我先查看其他项目的docs/用途..."
AI: list_dir("../monSQLize/docs")
AI: "分析结果：docs/用于API文档，不是设计文档"
AI: "建议结构：docs/api/, docs/guides/..."
AI: "是否按此创建？"
用户: "确认"
AI: 创建正确的目录结构
```

### 质量指标

| 指标 | 修复前 | 修复后 | 提升 |
|------|-------|-------|------|
| 可执行性 | ❌ 无流程 | ✅ 3步流程 | +100% |
| 示例丰富度 | ❌ 无示例 | ✅ 正确+错误示例 | +100% |
| 覆盖范围 | ⚠️ 仅数据库/API | ✅ 包含目录结构 | +50% |
| 可验证性 | ❌ 难以检测 | ✅ 明确违规标志 | +100% |

---

## 🎯 实施建议

### 立即修改

**文件**: global-copilot-instructions  
**位置**: 1.3节 - 执行原则 #4  
**操作**: 在"禁止猜测"原则后增加"创建项目目录前的查证流程"

### 验证方法

修改后，使用以下场景测试：

**测试场景1**: 用户询问"为什么没有examples目录"
- ✅ AI应该先查看其他项目的examples/目录
- ✅ AI应该分析目录用途
- ✅ AI应该询问用户确认

**测试场景2**: 用户询问"为什么没有scripts目录"
- ✅ AI应该执行完整的3步查证流程
- ✅ AI不应该凭常识直接创建

---

## 📝 附加建议

### 相关规范优化

除了本次修复，建议同步优化：

**1. 执行原则 #10: 禁止直接执行**

在触发条件中增加：
```markdown
触发条件（满足任一即触发）:
  ✅ 用户询问"为什么没有XX"、"缺少XX"（项目结构相关）← 🆕新增
```

**2. 1.3.1节: 需求分析流程**

在"非简单问答"判断中增加：
```markdown
❌ 例外：简单问答
  - "这个函数是干什么的？"
  - "如何使用XX？"
  - "XX是什么意思？"
  
但以下不是简单问答，需要分析:
  ✅ "为什么没有XX目录？" ← 🆕新增（需要查证和方案）
```

---

## 🎉 总结

### 本次修复

- **问题**: 规范未明确"创建项目目录前的查证流程"
- **类型**: 细节缺失
- **方案**: 扩展"执行原则 #4: 禁止猜测"
- **效果**: 提供3步查证流程，包含正确和错误示例

### 关键改进

1. ✅ 明确触发条件（用户询问目录问题）
2. ✅ 提供可执行的3步流程
3. ✅ 有正确和错误示例对比
4. ✅ 覆盖"项目目录结构"这一场景

### 经验总结

**为什么会违规**:
- 规范只列举了"数据库字段/API/技术栈"
- 未涵盖"项目目录结构"
- AI凭"常识"认为"docs/就是存文档的"

**如何避免**:
- 扩展"禁止猜测"的适用范围
- 提供明确的查证流程
- 用实际案例说明（monSQLize/docs/）

---

**报告生成**: 2025-12-24  
**下一步**: 应用修复到规范文件，并验证效果

