# v1.1.0 å˜æ›´æ—¥å¿—

> **å‘å¸ƒæ—¥æœŸ**: 2026-01-05  
> **ç‰ˆæœ¬å·**: v1.1.0  
> **ç±»å‹**: ğŸ‰ é‡å¤§åŠŸèƒ½å‘å¸ƒ

---

## ğŸ“‹ å˜æ›´æ¦‚è§ˆ

| ç±»å‹ | æ•°é‡ | è¯´æ˜ |
|------|------|------|
| ğŸ‰ æ–°åŠŸèƒ½ | 2 | è·¨ç±»å‹è”åˆéªŒè¯ã€è¿è¡Œæ—¶å¤šè¯­è¨€æ”¯æŒ |
| âš¡ åŠŸèƒ½å¢å¼º | 1 | æ’ä»¶ç³»ç»Ÿå¢å¼º |
| ğŸ“š æ–‡æ¡£æ›´æ–° | 3 | æ–°å¢è”åˆç±»å‹ã€è¿è¡Œæ—¶å¤šè¯­è¨€ã€æ’ä»¶æ–‡æ¡£ |

---

## ğŸ‰ æ–°åŠŸèƒ½

### 1. è·¨ç±»å‹è”åˆéªŒè¯ (Union Types)

**ä¸€è¡Œä»£ç æ”¯æŒå¤šç§ç±»å‹ï¼Œå‘Šåˆ«ç¹ççš„ç±»å‹åˆ¤æ–­**

#### åŸºç¡€ç”¨æ³•

```javascript
const { dsl, validate } = require('schema-dsl');

// å­—æ®µå¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–æ•°å­—
const schema = dsl({
  value: 'types:string|number'
});

validate(schema, { value: 'hello' });  // âœ… é€šè¿‡
validate(schema, { value: 123 });      // âœ… é€šè¿‡
validate(schema, { value: true });     // âŒ å¤±è´¥
```

#### å¸¦çº¦æŸçš„è”åˆç±»å‹

```javascript
// é‚®ç®±æˆ–æ‰‹æœºå·
const schema1 = dsl({
  contact: 'types:email|phone!'
});

// æ•°å­—ä»·æ ¼æˆ–"é¢è®®"å­—ç¬¦ä¸²
const schema2 = dsl({
  price: 'types:number:0-|string:1-20'
});

// æšä¸¾æˆ–ç©ºå€¼
const schema3 = dsl({
  status: 'types:active|inactive|null'
});
```

#### å®é™…åº”ç”¨åœºæ™¯

**åœºæ™¯1ï¼šç”¨æˆ·æ³¨å†Œ - æ”¯æŒé‚®ç®±æˆ–æ‰‹æœºå·**
```javascript
const registerSchema = dsl({
  username: 'string:3-20!',
  contact: 'types:email|phone!',  // çµæ´»çš„è”ç³»æ–¹å¼
  password: 'string:8-32!',
  age: 'types:integer:1-150|null' // å¹´é¾„å¯é€‰
});

// âœ… ä½¿ç”¨é‚®ç®±æ³¨å†Œ
validate(registerSchema, {
  username: 'john',
  contact: 'john@example.com',
  password: '12345678',
  age: 25
});

// âœ… ä½¿ç”¨æ‰‹æœºå·æ³¨å†Œ
validate(registerSchema, {
  username: 'jane',
  contact: '13800138000',
  password: 'abcd1234',
  age: null
});
```

**åœºæ™¯2ï¼šå•†å“ä»·æ ¼ - æ•°å­—æˆ–"é¢è®®"**
```javascript
const productSchema = dsl({
  name: 'string:1-100!',
  price: 'types:number:0-|string:1-20',  // ä»·æ ¼æˆ–"é¢è®®"
  stock: 'integer:0-'
});

// âœ… æ•°å­—ä»·æ ¼
validate(productSchema, {
  name: 'å•†å“A',
  price: 99.99,
  stock: 100
});

// âœ… "é¢è®®"ä»·æ ¼
validate(productSchema, {
  name: 'å•†å“B',
  price: 'é¢è®®',
  stock: 0
});
```

**åœºæ™¯3ï¼šAPIå‚æ•° - å•ä¸ªIDæˆ–IDæ•°ç»„**
```javascript
const querySchema = dsl({
  id: 'types:string|array<string>'  // å•ä¸ªæˆ–å¤šä¸ªID
});

// âœ… å•ä¸ªID
validate(querySchema, { id: '123' });

// âœ… IDæ•°ç»„
validate(querySchema, { id: ['123', '456', '789'] });
```

#### æŠ€æœ¯å®ç°

- âœ… æ”¯æŒåŸºç¡€ç±»å‹è”åˆï¼š`string|number|boolean`
- âœ… æ”¯æŒæ ¼å¼ç±»å‹è”åˆï¼š`email|phone|url`
- âœ… æ”¯æŒå¸¦çº¦æŸçš„è”åˆï¼š`number:0-100|string:1-20`
- âœ… æ”¯æŒnullå€¼ï¼š`string|null`
- âœ… æ”¯æŒæ•°ç»„ç±»å‹ï¼š`string|array<string>`

---

### 2. è¿è¡Œæ—¶å¤šè¯­è¨€æ”¯æŒ

**æ— éœ€ä¿®æ”¹å…¨å±€è®¾ç½®ï¼Œæ¯æ¬¡è°ƒç”¨æ—¶æŒ‡å®šè¯­è¨€**

#### æ ¸å¿ƒAPI

**dsl.error.create()** - åˆ›å»ºå¤šè¯­è¨€é”™è¯¯
```javascript
dsl.error.create(
  code: string,          // é”™è¯¯ä»£ç ï¼ˆå¦‚ 'account.notFound'ï¼‰
  params?: object,       // å‚æ•°æ’å€¼ï¼ˆå¦‚ { balance: 50 }ï¼‰
  statusCode?: number,   // HTTP çŠ¶æ€ç ï¼ˆé»˜è®¤ 400ï¼‰
  locale?: string        // ğŸ†• è¿è¡Œæ—¶è¯­è¨€ï¼ˆå¦‚ 'en-US'ï¼‰
): I18nError
```

**dsl.error.throw()** - æŠ›å‡ºå¤šè¯­è¨€é”™è¯¯
```javascript
dsl.error.throw(
  code: string,
  params?: object,
  statusCode?: number,
  locale?: string        // ğŸ†• è¿è¡Œæ—¶è¯­è¨€
): never
```

**dsl.error.assert()** - æ–­è¨€å¤šè¯­è¨€é”™è¯¯
```javascript
dsl.error.assert(
  condition: any,
  code: string,
  params?: object,
  statusCode?: number,
  locale?: string        // ğŸ†• è¿è¡Œæ—¶è¯­è¨€
): void
```

#### ä½¿ç”¨ç¤ºä¾‹

**æ–¹å¼1ï¼šæ ¹æ®è¯·æ±‚å¤´åŠ¨æ€è¿”å›ä¸åŒè¯­è¨€**
```javascript
app.post('/api/account', (req, res) => {
  const locale = req.headers['accept-language'] || 'en-US';
  const account = getAccount(req.user.id);
  
  try {
    // è¿è¡Œæ—¶æŒ‡å®šè¯­è¨€ï¼Œä¸å½±å“å…¨å±€è®¾ç½®
    dsl.error.assert(account, 'account.notFound', {}, 404, locale);
    
    dsl.error.assert(
      account.balance >= 100,
      'account.insufficientBalance',
      { balance: account.balance, required: 100 },
      400,
      locale
    );
    
    // éªŒè¯é€šè¿‡ï¼Œç»§ç»­å¤„ç†...
    res.json({ success: true });
  } catch (error) {
    // é”™è¯¯æ¶ˆæ¯å·²ç»æ˜¯è¯·æ±‚çš„è¯­è¨€
    res.status(error.statusCode).json(error.toJSON());
  }
});
```

**æ–¹å¼2ï¼šåŒä¸€è¯·æ±‚ä¸­ä½¿ç”¨å¤šç§è¯­è¨€**
```javascript
// åˆ›å»ºä¸åŒè¯­è¨€çš„é”™è¯¯æ¶ˆæ¯
const error1 = dsl.error.create('account.notFound', {}, 404, 'zh-CN');
console.log(error1.message);  // "è´¦æˆ·ä¸å­˜åœ¨"
console.log(error1.locale);   // "zh-CN"

const error2 = dsl.error.create('account.notFound', {}, 404, 'en-US');
console.log(error2.message);  // "Account not found"
console.log(error2.locale);   // "en-US"

const error3 = dsl.error.create('account.notFound', {}, 404, 'ja-JP');
console.log(error3.message);  // "ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
console.log(error3.locale);   // "ja-JP"
```

**æ–¹å¼3ï¼šå¾®æœåŠ¡æ¶æ„ - é”™è¯¯ä¼ é€’ä¿æŒåŸè¯­è¨€**
```javascript
// æœåŠ¡AæŠ›å‡ºé”™è¯¯ï¼ˆå¸¦è¯­è¨€ä¿¡æ¯ï¼‰
class ServiceA {
  async getAccount(id, locale) {
    const account = await db.findAccount(id);
    dsl.error.assert(account, 'account.notFound', {}, 404, locale);
    return account;
  }
}

// æœåŠ¡Bæ¥æ”¶é”™è¯¯ï¼ˆä¿æŒåŸè¯­è¨€ï¼‰
class ServiceB {
  async processAccount(accountId, locale) {
    try {
      const account = await serviceA.getAccount(accountId, locale);
      // å¤„ç†è´¦æˆ·...
    } catch (error) {
      if (error instanceof I18nError) {
        // é”™è¯¯æ¶ˆæ¯ä¿æŒåŸè¯­è¨€
        console.log(error.locale);   // locale å‚æ•°ä¼ å…¥çš„è¯­è¨€
        console.log(error.message);  // è¯¥è¯­è¨€çš„é”™è¯¯æ¶ˆæ¯
        
        // è½¬å‘ç»™å®¢æˆ·ç«¯
        throw error;
      }
    }
  }
}
```

#### é€‚ç”¨åœºæ™¯

- âœ… **å¤šè¯­è¨€ API**: æ ¹æ®è¯·æ±‚å¤´ `Accept-Language` åŠ¨æ€è¿”å›
- âœ… **å¾®æœåŠ¡æ¶æ„**: é”™è¯¯åœ¨æœåŠ¡é—´ä¼ é€’æ—¶ä¿æŒåŸè¯­è¨€
- âœ… **å›½é™…åŒ–åº”ç”¨**: åŒä¸€è¯·æ±‚ä¸­éœ€è¦å¤šç§è¯­è¨€çš„é”™è¯¯æ¶ˆæ¯
- âœ… **A/Bæµ‹è¯•**: ä¸åŒç”¨æˆ·ç»„ä½¿ç”¨ä¸åŒè¯­è¨€

#### ä¸å…¨å±€è¯­è¨€è®¾ç½®çš„å¯¹æ¯”

| ç‰¹æ€§ | å…¨å±€è®¾ç½® | è¿è¡Œæ—¶æŒ‡å®š |
|------|---------|-----------|
| **ä½¿ç”¨åœºæ™¯** | å•ä¸€è¯­è¨€åº”ç”¨ | å¤šè¯­è¨€API |
| **åˆ‡æ¢æ–¹å¼** | `Locale.setLocale()` | æ¯æ¬¡è°ƒç”¨æŒ‡å®š |
| **å½±å“èŒƒå›´** | å…¨å±€æ‰€æœ‰é”™è¯¯ | ä»…å½“å‰é”™è¯¯ |
| **çº¿ç¨‹å®‰å…¨** | âš ï¸ éœ€æ³¨æ„å¹¶å‘ | âœ… å®Œå…¨å®‰å…¨ |
| **æ¨èåº¦** | ç®€å•åº”ç”¨ | **APIå¼€å‘** |

---

### 3. æ’ä»¶ç³»ç»Ÿå¢å¼º

**ç®€åŒ–è‡ªå®šä¹‰ç±»å‹æ³¨å†Œæµç¨‹**

#### æ”¹è¿›å‰ï¼ˆv1.0.xï¼‰

```javascript
// éœ€è¦æ‰‹åŠ¨å¤„ç†æ³¨å†Œé€»è¾‘
const customValidator = {
  name: 'slug',
  validate: (value) => /^[a-z0-9-]+$/.test(value)
};

// æ‰‹åŠ¨æ·»åŠ åˆ°éªŒè¯å™¨
validator.addCustomType('slug', customValidator);
```

#### æ”¹è¿›åï¼ˆv1.1.0+ï¼‰

```javascript
// ä½¿ç”¨æ’ä»¶ç³»ç»Ÿç»Ÿä¸€ç®¡ç†
const slugPlugin = {
  name: 'slug-validator',
  version: '1.0.0',
  install(core) {
    core.registerType('slug', {
      validate: (value) => /^[a-z0-9-]+$/.test(value),
      message: 'must be a valid slug (lowercase, numbers, hyphens)'
    });
  }
};

// æ³¨å†Œæ’ä»¶
pluginManager.register(slugPlugin);
pluginManager.install(schemaCore);

// ä½¿ç”¨è‡ªå®šä¹‰ç±»å‹
const schema = dsl({ url: 'slug!' });
```

#### æ–°å¢åŠŸèƒ½

- âœ… æ’ä»¶ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ˆinstall/uninstallï¼‰
- âœ… æ’ä»¶ç‰ˆæœ¬æ§åˆ¶
- âœ… æ’ä»¶ä¾èµ–æ£€æŸ¥
- âœ… æ’ä»¶çƒ­é‡è½½ï¼ˆå¼€å‘ç¯å¢ƒï¼‰

---

## ğŸ“š æ–‡æ¡£æ›´æ–°

1. âœ… **è”åˆç±»å‹æ–‡æ¡£**: [docs/union-types.md](../docs/union-types.md)
2. âœ… **è¿è¡Œæ—¶å¤šè¯­è¨€æ–‡æ¡£**: [docs/runtime-locale-support.md](../docs/runtime-locale-support.md)
3. âœ… **æ’ä»¶ç³»ç»Ÿæ–‡æ¡£**: [docs/plugin-system.md](../docs/plugin-system.md)

---

## ğŸ”„ ç ´åæ€§å˜æ›´

**æ— ç ´åæ€§å˜æ›´** - æ‰€æœ‰æ–°åŠŸèƒ½éƒ½æ˜¯å‘åå…¼å®¹çš„ã€‚

---

## ğŸ¯ å‡çº§æŒ‡å—

### ä» v1.0.x å‡çº§åˆ° v1.1.0

```bash
npm install schema-dsl@1.1.0
```

**å¯é€‰ï¼šå¯ç”¨æ–°åŠŸèƒ½**

1. **ä½¿ç”¨è”åˆç±»å‹**ï¼ˆå¯é€‰ï¼‰
   ```javascript
   // ä¹‹å‰
   const schema = dsl({ value: 'string' });
   
   // ç°åœ¨ï¼ˆå¯é€‰ä½¿ç”¨ï¼‰
   const schema = dsl({ value: 'types:string|number' });
   ```

2. **ä½¿ç”¨è¿è¡Œæ—¶å¤šè¯­è¨€**ï¼ˆå¯é€‰ï¼‰
   ```javascript
   // ä¹‹å‰
   I18nError.throw('account.notFound');
   
   // ç°åœ¨ï¼ˆå¯é€‰ä½¿ç”¨ï¼‰
   I18nError.throw('account.notFound', {}, 404, 'en-US');
   ```

---

## ğŸ“¦ ä¾èµ–å˜æ›´

**æ— ä¾èµ–å˜æ›´**

---

## ğŸ“Š æ€§èƒ½å½±å“

- âœ… è”åˆç±»å‹éªŒè¯ï¼šæ€§èƒ½æŸå¤± <5%ï¼ˆå¯æ¥å—ï¼‰
- âœ… è¿è¡Œæ—¶å¤šè¯­è¨€ï¼šæ— æ€§èƒ½å½±å“ï¼ˆä»…å‚æ•°ä¼ é€’ï¼‰
- âœ… æ’ä»¶ç³»ç»Ÿï¼šåˆå§‹åŒ–æ€§èƒ½ä¼˜åŒ– 10%

---

## ğŸ™ è‡´è°¢

æ„Ÿè°¢ç¤¾åŒºè´¡çŒ®è€…æå‡ºè”åˆç±»å‹éªŒè¯çš„éœ€æ±‚å’Œåé¦ˆã€‚

---

## ğŸ”— ç›¸å…³é“¾æ¥

- [GitHub Repository](https://github.com/vextjs/schema-dsl)
- [npm Package](https://www.npmjs.com/package/schema-dsl)
- [å®Œæ•´æ–‡æ¡£](../docs/INDEX.md)

---

**å‘å¸ƒè€…**: schema-dsl Team  
**å‘å¸ƒæ—¶é—´**: 2026-01-05  
**ä¸‹ä¸€ç‰ˆæœ¬**: v1.1.1

