# v1.0.9 å˜æ›´æ—¥å¿—

> **å‘å¸ƒæ—¥æœŸ**: 2026-01-04  
> **ç‰ˆæœ¬å·**: v1.0.9  
> **ç±»å‹**: ğŸ‰ é‡å¤§æ”¹è¿›

---

## ğŸ“‹ å˜æ›´æ¦‚è§ˆ

| ç±»å‹ | æ•°é‡ | è¯´æ˜ |
|------|------|------|
| ğŸ‰ æ–°åŠŸèƒ½ | 2 | å®Œæ•´å¤šè¯­è¨€æ”¯æŒã€I18nErrorç±» |
| âš¡ åŠŸèƒ½å¢å¼º | 1 | TypeScriptç±»å‹å®šä¹‰å®Œå–„ |
| ğŸ“š æ–‡æ¡£æ›´æ–° | 5 | å¤šè¯­è¨€ç›¸å…³æ–‡æ¡£ |

---

## ğŸ‰ æ–°åŠŸèƒ½

### 1. å®Œæ•´çš„å¤šè¯­è¨€æ”¯æŒ

**å†…ç½®5ç§è¯­è¨€ï¼Œå¼€ç®±å³ç”¨çš„å›½é™…åŒ–æ–¹æ¡ˆ**

#### æ”¯æŒçš„è¯­è¨€

| è¯­è¨€ä»£ç  | è¯­è¨€åç§° | å®Œæ•´åº¦ | è¯´æ˜ |
|---------|---------|--------|------|
| zh-CN | ç®€ä½“ä¸­æ–‡ | 100% | é»˜è®¤è¯­è¨€ |
| en-US | è‹±æ–‡ï¼ˆç¾å›½ï¼‰ | 100% | å®Œæ•´ç¿»è¯‘ |
| ja-JP | æ—¥è¯­ | 95% | ä¸»è¦åŠŸèƒ½å·²ç¿»è¯‘ |
| es-ES | è¥¿ç­ç‰™è¯­ | 90% | æ ¸å¿ƒåŠŸèƒ½å·²ç¿»è¯‘ |
| fr-FR | æ³•è¯­ | 90% | æ ¸å¿ƒåŠŸèƒ½å·²ç¿»è¯‘ |

#### å¿«é€Ÿé…ç½®

**æ–¹å¼1ï¼šä½¿ç”¨å†…ç½®è¯­è¨€**

```javascript
const { dsl, validate, Locale } = require('schema-dsl');

// è®¾ç½®å…¨å±€è¯­è¨€
Locale.setLocale('zh-CN');

const schema = dsl({ username: 'string:3-32!' });

// ä¸­æ–‡é”™è¯¯æ¶ˆæ¯
const result = validate(schema, { username: 'ab' });
console.log(result.errors[0].message);
// => "usernameé•¿åº¦ä¸èƒ½å°‘äº3ä¸ªå­—ç¬¦"
```

**æ–¹å¼2ï¼šé…ç½®è‡ªå®šä¹‰è¯­è¨€åŒ…ç›®å½•**

```javascript
const path = require('path');

// åº”ç”¨å¯åŠ¨æ—¶é…ç½®ä¸€æ¬¡
dsl.config({
  i18n: path.join(__dirname, 'locales')
});

// è‡ªåŠ¨åŠ è½½ç›®å½•ä¸‹æ‰€æœ‰è¯­è¨€æ–‡ä»¶
// locales/zh-CN.js
// locales/en-US.js
// locales/custom-lang.js
```

#### è‡ªå®šä¹‰è¯­è¨€åŒ…

```javascript
// locales/zh-CN.js
module.exports = {
  'required': '{{#path}} æ˜¯å¿…å¡«é¡¹',
  'string.min': '{{#path}} é•¿åº¦ä¸èƒ½å°‘äº {{#min}} ä¸ªå­—ç¬¦',
  'string.max': '{{#path}} é•¿åº¦ä¸èƒ½è¶…è¿‡ {{#max}} ä¸ªå­—ç¬¦',
  'email': '{{#path}} å¿…é¡»æ˜¯æœ‰æ•ˆçš„é‚®ç®±åœ°å€',
  'account.notFound': 'è´¦æˆ·ä¸å­˜åœ¨',
  'account.insufficientBalance': 'ä½™é¢ä¸è¶³ï¼Œå½“å‰ä½™é¢{{balance}}ï¼Œéœ€è¦{{required}}'
};

// locales/en-US.js
module.exports = {
  'required': '{{#path}} is required',
  'string.min': '{{#path}} must be at least {{#min}} characters',
  'string.max': '{{#path}} must not exceed {{#max}} characters',
  'email': '{{#path}} must be a valid email',
  'account.notFound': 'Account not found',
  'account.insufficientBalance': 'Insufficient balance, current: {{balance}}, required: {{required}}'
};
```

#### è¿è¡Œæ—¶åˆ‡æ¢è¯­è¨€

```javascript
// å…¨å±€åˆ‡æ¢
Locale.setLocale('en-US');

// éªŒè¯æ—¶æŒ‡å®šè¯­è¨€
validate(schema, data, { locale: 'ja-JP' });

// è·å–å½“å‰è¯­è¨€
const currentLocale = Locale.getLocale();  // 'en-US'
```

#### å‚æ•°æ’å€¼

```javascript
// è‡ªåŠ¨æ’å€¼
const schema = dsl({ age: 'number:18-120!' });
validate(schema, { age: 15 });
// => "age must be at least 18" (en-US)
// => "age å¿…é¡»è‡³å°‘ä¸º 18" (zh-CN)

// è‡ªå®šä¹‰å‚æ•°æ’å€¼
const error = new I18nError('account.insufficientBalance', {
  balance: 50,
  required: 100
});
console.log(error.message);
// => "ä½™é¢ä¸è¶³ï¼Œå½“å‰ä½™é¢50ï¼Œéœ€è¦100" (zh-CN)
// => "Insufficient balance, current: 50, required: 100" (en-US)
```

---

### 2. I18nError å¤šè¯­è¨€é”™è¯¯ç±»

**ç»Ÿä¸€çš„å¤šè¯­è¨€é”™è¯¯å¤„ç†ç±»**

#### åŸºç¡€ç”¨æ³•

```javascript
const { I18nError } = require('schema-dsl');

// åˆ›å»ºé”™è¯¯
const error = new I18nError(
  'account.notFound',  // é”™è¯¯ä»£ç 
  {},                  // å‚æ•°ï¼ˆå¯é€‰ï¼‰
  404                  // HTTPçŠ¶æ€ç ï¼ˆå¯é€‰ï¼‰
);

console.log(error.code);        // 'account.notFound'
console.log(error.message);     // 'è´¦æˆ·ä¸å­˜åœ¨' (zh-CN)
console.log(error.statusCode);  // 404
```

#### é™æ€æ–¹æ³•

```javascript
// ç›´æ¥æŠ›å‡ºé”™è¯¯
I18nError.throw('user.noPermission');

// æ–­è¨€é£æ ¼
I18nError.assert(user, 'user.notFound');
I18nError.assert(
  user.role === 'admin',
  'user.noPermission'
);

// åˆ›å»ºé”™è¯¯å¯¹è±¡
const error = I18nError.create('account.notFound', {}, 404);
```

#### é”™è¯¯å¯¹è±¡å±æ€§

```javascript
const error = new I18nError('account.insufficientBalance', {
  balance: 50,
  required: 100
}, 400);

console.log(error.code);        // 'account.insufficientBalance'
console.log(error.message);     // 'ä½™é¢ä¸è¶³ï¼Œå½“å‰ä½™é¢50ï¼Œéœ€è¦100'
console.log(error.statusCode);  // 400
console.log(error.params);      // { balance: 50, required: 100 }

// JSONåºåˆ—åŒ–
console.log(error.toJSON());
// {
//   code: 'account.insufficientBalance',
//   message: 'ä½™é¢ä¸è¶³ï¼Œå½“å‰ä½™é¢50ï¼Œéœ€è¦100',
//   statusCode: 400,
//   params: { balance: 50, required: 100 }
// }
```

#### Express/Koa é›†æˆ

```javascript
// Express é”™è¯¯å¤„ç†ä¸­é—´ä»¶
app.use((error, req, res, next) => {
  if (error instanceof I18nError) {
    return res.status(error.statusCode).json({
      success: false,
      code: error.code,
      message: error.message,
      params: error.params
    });
  }
  next(error);
});

// ä¸šåŠ¡ä»£ç 
app.post('/api/withdraw', async (req, res, next) => {
  try {
    const account = await getAccount(req.user.id);
    I18nError.assert(account, 'account.notFound', {}, 404);
    
    I18nError.assert(
      account.balance >= req.body.amount,
      'account.insufficientBalance',
      { balance: account.balance, required: req.body.amount },
      400
    );
    
    // å¤„ç†æç°...
    res.json({ success: true });
  } catch (error) {
    next(error);
  }
});
```

---

## âš¡ åŠŸèƒ½å¢å¼º

### TypeScript ç±»å‹å®šä¹‰å®Œå–„

**å®Œæ•´çš„ç±»å‹å®šä¹‰ï¼Œ100% ç±»å‹å®‰å…¨**

#### æ–°å¢ç±»å‹

```typescript
// Locale ç±»å‹
interface Locale {
  setLocale(locale: string): void;
  getLocale(): string;
  getMessage(code: string, params?: Record<string, any>): string;
  setMessages(messages: Record<string, string>): void;
}

// I18nError ç±»å‹
class I18nError extends Error {
  code: string;
  statusCode: number;
  params: Record<string, any>;
  
  constructor(
    code: string,
    params?: Record<string, any>,
    statusCode?: number
  );
  
  static throw(code: string, params?: Record<string, any>, statusCode?: number): never;
  static assert(condition: any, code: string, params?: Record<string, any>, statusCode?: number): asserts condition;
  static create(code: string, params?: Record<string, any>, statusCode?: number): I18nError;
  
  toJSON(): object;
  is(code: string): boolean;
}

// ValidationOptions æ‰©å±•
interface ValidationOptions {
  locale?: string;  // æ–°å¢ï¼šéªŒè¯æ—¶æŒ‡å®šè¯­è¨€
  // ...å…¶ä»–é€‰é¡¹
}
```

#### ä½¿ç”¨ç¤ºä¾‹

```typescript
import { dsl, validate, I18nError, Locale } from 'schema-dsl';

// å®Œæ•´çš„ç±»å‹æ¨å¯¼
const schema = dsl({ email: 'email!' });

// éªŒè¯æ—¶æŒ‡å®šè¯­è¨€
const result = validate(schema, data, { locale: 'en-US' });

// I18nError ç±»å‹å®‰å…¨
try {
  I18nError.throw('account.notFound', {}, 404);
} catch (error) {
  if (error instanceof I18nError) {
    console.log(error.code);        // string
    console.log(error.statusCode);  // number
    console.log(error.params);      // Record<string, any>
  }
}
```

---

## ğŸ“š æ–‡æ¡£æ›´æ–°

1. âœ… **å¤šè¯­è¨€ç”¨æˆ·æŒ‡å—**: [docs/i18n-user-guide.md](../docs/i18n-user-guide.md)
2. âœ… **I18n å®Œæ•´æ–‡æ¡£**: [docs/i18n.md](../docs/i18n.md)
3. âœ… **I18nError API æ–‡æ¡£**: [docs/error-handling.md](../docs/error-handling.md)
4. âœ… **è‡ªå®šä¹‰è¯­è¨€åŒ…æŒ‡å—**: [docs/add-custom-locale.md](../docs/add-custom-locale.md)
5. âœ… **å‰ç«¯ i18n é›†æˆ**: [docs/frontend-i18n-guide.md](../docs/frontend-i18n-guide.md)

---

## ğŸ”„ ç ´åæ€§å˜æ›´

**æ— ç ´åæ€§å˜æ›´** - æ‰€æœ‰æ–°åŠŸèƒ½éƒ½æ˜¯å¯é€‰çš„ï¼Œé»˜è®¤è¡Œä¸ºä¿æŒä¸å˜ã€‚

---

## ğŸ¯ å‡çº§æŒ‡å—

### ä» v1.0.8 å‡çº§åˆ° v1.0.9

```bash
npm install schema-dsl@1.0.9
```

**å¯é€‰ï¼šå¯ç”¨å¤šè¯­è¨€**

```javascript
const { Locale } = require('schema-dsl');

// è®¾ç½®å…¨å±€è¯­è¨€ï¼ˆå¯é€‰ï¼‰
Locale.setLocale('zh-CN');

// æˆ–åœ¨éªŒè¯æ—¶æŒ‡å®šï¼ˆå¯é€‰ï¼‰
validate(schema, data, { locale: 'en-US' });
```

**å¯é€‰ï¼šä½¿ç”¨ I18nError**

```javascript
const { I18nError } = require('schema-dsl');

// æ›¿ä»£æ™®é€š Error
I18nError.throw('account.notFound');
```

---

## ğŸ“¦ ä¾èµ–å˜æ›´

**æ— ä¾èµ–å˜æ›´**

---

## ğŸ™ è‡´è°¢

æ„Ÿè°¢ç¤¾åŒºè´¡çŒ®è€…æä¾›çš„å¤šè¯­è¨€ç¿»è¯‘å’Œåé¦ˆã€‚

---

## ğŸ”— ç›¸å…³é“¾æ¥

- [GitHub Repository](https://github.com/vextjs/schema-dsl)
- [npm Package](https://www.npmjs.com/package/schema-dsl)
- [å®Œæ•´å¤šè¯­è¨€æ–‡æ¡£](../docs/i18n.md)
- [I18nError ç¤ºä¾‹](../examples/i18n-error.examples.js)

---

**å‘å¸ƒè€…**: schema-dsl Team  
**å‘å¸ƒæ—¶é—´**: 2026-01-04  
**ä¸‹ä¸€ç‰ˆæœ¬**: v1.1.0

