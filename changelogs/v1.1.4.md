# v1.1.4 å˜æ›´æ—¥å¿—

> **å‘å¸ƒæ—¥æœŸ**: 2026-01-13  
> **ç‰ˆæœ¬å·**: v1.1.4  
> **ç±»å‹**: ğŸ”§ TypeScriptç±»å‹ä¿®å¤ + ğŸ“š æ–‡æ¡£å®Œå–„

---

## ğŸ“‹ å˜æ›´æ¦‚è§ˆ

| ç±»å‹ | æ•°é‡ | è¯´æ˜ |
|------|------|------|
| ğŸ”§ Bugä¿®å¤ | 2 | TypeScript ç±»å‹å®šä¹‰é‡å¤ç­¾å |
| ğŸ“š æ–‡æ¡£æ›´æ–° | 3 | å¤šè¯­è¨€æ–‡æ¡£å®Œå–„ |
| âœ… éªŒè¯æµ‹è¯• | 3 | å¤šè¯­è¨€ã€è¯­æ³•ã€ç±»å‹éªŒè¯ |
| ğŸ”„ å†…éƒ¨æ”¹è¿› | 1 | CHANGELOG æ ¼å¼ç»Ÿä¸€ |

---

## ğŸ”§ TypeScript ç±»å‹ä¿®å¤

### é—®é¢˜æè¿°

index.d.ts ä¸­å­˜åœ¨2å¤„é‡å¤çš„å‡½æ•°ç­¾åå®šä¹‰ï¼Œå¯¼è‡´ TypeScript ç¼–è¯‘å™¨æŠ¥é”™ï¼ˆ46ä¸ªç±»å‹é”™è¯¯ï¼‰ã€‚

### ä¿®å¤è¯¦æƒ…

#### 1. dsl.error.assert é‡å¤ç­¾å

**ä½ç½®**: `index.d.ts` ç¬¬1336-1343è¡Œ

**ä¿®å¤å‰**:
```typescript
assert(
  condition: any,
  code: string,
  params?: Record<string, any>,
  statusCode?: number,
  locale?: string
): asserts condition;
  statusCode?: number       // âŒ é‡å¤è¡Œ
): asserts condition;       // âŒ é‡å¤è¡Œ
```

**ä¿®å¤å**:
```typescript
assert(
  condition: any,
  code: string,
  params?: Record<string, any>,
  statusCode?: number,
  locale?: string
): asserts condition;
```

**é”™è¯¯ä¿¡æ¯**:
```
TS1131: Property or signature expected.
TS1128: Declaration or statement expected.
åº”ä¸ºç±»å‹æˆå‘˜
```

---

#### 2. I18nError.assert é‡å¤ç­¾å

**ä½ç½®**: `index.d.ts` ç¬¬1805-1821è¡Œ

**ä¿®å¤å‰**:
```typescript
static assert(
  condition: any,
  code: string,
  params?: Record<string, any>,
  statusCode?: number,
  locale?: string
): asserts condition;
 */                          // âŒ æ³¨é‡Šä½ç½®é”™è¯¯
static assert(               // âŒ é‡å¤å®šä¹‰
  condition: any,
  code: string,
  params?: Record<string, any>,
  statusCode?: number
): asserts condition;
```

**ä¿®å¤å**:
```typescript
/**
 * æ–­è¨€æ–¹æ³• - æ¡ä»¶ä¸æ»¡è¶³æ—¶æŠ›é”™
 * @param condition - æ¡ä»¶è¡¨è¾¾å¼
 * @param code - é”™è¯¯ä»£ç 
 * @param params - é”™è¯¯å‚æ•°
 * @param statusCode - HTTP çŠ¶æ€ç 
 * @param locale - è¯­è¨€ç¯å¢ƒï¼ˆå¯é€‰ï¼Œä¸ä¼ åˆ™ä½¿ç”¨å…¨å±€è¯­è¨€ï¼‰
 * @throws I18nError æ¡ä»¶ä¸º false æ—¶æŠ›å‡º
 */
static assert(
  condition: any,
  code: string,
  params?: Record<string, any>,
  statusCode?: number,
  locale?: string
): asserts condition;
```

**é”™è¯¯ä¿¡æ¯**:
```
TS1128: Declaration or statement expected.
åº”ä¸ºè¯­å¥
TS1003: Identifier expected.
```

---

### ä¿®å¤ç»“æœ

**ä¿®å¤å‰**:
- âŒ 46ä¸ªç±»å‹é”™è¯¯
- âš ï¸ 1ä¸ªè­¦å‘Š

**ä¿®å¤å**:
- âœ… 0ä¸ªç±»å‹é”™è¯¯
- âš ï¸ 2ä¸ªå¯å¿½ç•¥è­¦å‘Šï¼ˆè®¾è®¡å†³ç­–ï¼‰

**å‰©ä½™è­¦å‘Š**:
1. `export { _if as if }` - ä¿ç•™è¯è­¦å‘Šï¼ˆè®¾è®¡å†³ç­–ï¼Œä¸ºäº†æä¾›æ›´å¥½çš„APIï¼‰
2. `toJsonSchema()` - æœªä½¿ç”¨æ–¹æ³•è­¦å‘Šï¼ˆå‘åå…¼å®¹ä¿ç•™ï¼‰

---

### å½±å“èŒƒå›´

- âœ… **ä»…å½±å“**: TypeScript ç±»å‹æ£€æŸ¥
- âœ… **ä¸å½±å“**: è¿è¡Œæ—¶é€»è¾‘
- âœ… **å‘åå…¼å®¹**: æ— ç ´åæ€§å˜æ›´
- âœ… **æµ‹è¯•çŠ¶æ€**: 921ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡

---

## ğŸ“š æ–‡æ¡£æ›´æ–°

### 1. å®Œå–„è¿è¡Œæ—¶å¤šè¯­è¨€æ”¯æŒæ–‡æ¡£

**æ–‡ä»¶**: `docs/runtime-locale-support.md`

**æ›´æ–°å†…å®¹**:
- âœ… ç‰ˆæœ¬æ ‡è®°æ›´æ–°ä¸º v1.1.4+
- âœ… å…¨å±€è¯­è¨€è®¾ç½® vs è¿è¡Œæ—¶æŒ‡å®šè¯­è¨€å¯¹æ¯”
- âœ… API å‚æ•°è¯¦ç»†è¯´æ˜
- âœ… Express/Koa é›†æˆç¤ºä¾‹
- âœ… å¾®æœåŠ¡æ¶æ„ä¸­çš„å¤šè¯­è¨€é”™è¯¯ä¼ é€’
- âœ… æœ€ä½³å®è·µå»ºè®®

**æ ¸å¿ƒç¤ºä¾‹**:

```javascript
// è¿è¡Œæ—¶æŒ‡å®šè¯­è¨€ï¼ˆä¸å½±å“å…¨å±€è®¾ç½®ï¼‰
const error1 = dsl.error.create('account.notFound', {}, 404, 'zh-CN');
// message: "è´¦æˆ·ä¸å­˜åœ¨"

const error2 = dsl.error.create('account.notFound', {}, 404, 'en-US');
// message: "Account not found"

// æ ¹æ®è¯·æ±‚å¤´åŠ¨æ€è¿”å›
app.post('/api/account', (req, res) => {
  const locale = req.headers['accept-language'] || 'en-US';
  dsl.error.assert(account, 'account.notFound', {}, 404, locale);
});
```

---

### 2. æ›´æ–° README.md å¤šè¯­è¨€ç« èŠ‚

**æ–‡ä»¶**: `README.md`

**æ–°å¢å†…å®¹**:

#### è¿è¡Œæ—¶å¤šè¯­è¨€æ”¯æŒï¼ˆv1.1.0+ï¼‰

```javascript
const { dsl, I18nError } = require('schema-dsl');

// æ–¹å¼1: ä¸šåŠ¡é”™è¯¯ - è¿è¡Œæ—¶æŒ‡å®šè¯­è¨€
const error1 = dsl.error.create('account.notFound', {}, 404, 'zh-CN');
console.log(error1.message);  // "è´¦æˆ·ä¸å­˜åœ¨"

const error2 = dsl.error.create('account.notFound', {}, 404, 'en-US');
console.log(error2.message);  // "Account not found"

// æ–¹å¼2: æ–­è¨€é£æ ¼ - æ ¹æ®è¯·æ±‚å¤´åŠ¨æ€æŒ‡å®š
app.post('/api/withdraw', (req, res) => {
  const locale = req.headers['accept-language'] || 'en-US';
  const account = getAccount(req.user.id);
  
  // æ ¹æ®è¯·æ±‚å¤´è¿”å›å¯¹åº”è¯­è¨€çš„é”™è¯¯
  I18nError.assert(account, 'account.notFound', {}, 404, locale);
  I18nError.assert(
    account.balance >= req.body.amount,
    'account.insufficientBalance',
    { balance: account.balance, required: req.body.amount },
    400,
    locale
  );
  
  // éªŒè¯é€šè¿‡ï¼Œç»§ç»­å¤„ç†...
});
```

**é€‚ç”¨åœºæ™¯**:
- âœ… å¤šè¯­è¨€ APIï¼ˆæ ¹æ®è¯·æ±‚å¤´è¿”å›ä¸åŒè¯­è¨€ï¼‰
- âœ… å¾®æœåŠ¡æ¶æ„ï¼ˆé”™è¯¯åœ¨æœåŠ¡é—´ä¼ é€’æ—¶ä¿æŒè¯­è¨€ï¼‰
- âœ… åŒä¸€è¯·æ±‚ä¸­éœ€è¦å¤šç§è¯­è¨€çš„é”™è¯¯æ¶ˆæ¯

---

### 3. æ›´æ–° README.md Q8ç« èŠ‚

**å¢å¼ºå†…å®¹**: æ·»åŠ è¿è¡Œæ—¶è¯­è¨€æ”¯æŒç¤ºä¾‹

```javascript
// æ ¹æ®è¯·æ±‚å¤´åŠ¨æ€è¿”å›ä¸åŒè¯­è¨€
app.post('/api/account', (req, res, next) => {
  const locale = req.headers['accept-language'] || 'en-US';
  const account = getAccount(req.user.id);
  
  try {
    // ç¬¬5ä¸ªå‚æ•°æŒ‡å®šè¯­è¨€
    dsl.error.assert(account, 'account.notFound', {}, 404, locale);
    dsl.error.assert(
      account.balance >= 100,
      'account.insufficientBalance',
      { balance: account.balance, required: 100 },
      400,
      locale
    );
    // éªŒè¯é€šè¿‡...
  } catch (error) {
    next(error);
  }
});

// åŒä¸€è¯·æ±‚ä¸­ä½¿ç”¨ä¸åŒè¯­è¨€
const error1 = dsl.error.create('account.notFound', {}, 404, 'zh-CN');
console.log(error1.message);  // "è´¦æˆ·ä¸å­˜åœ¨"

const error2 = dsl.error.create('account.notFound', {}, 404, 'en-US');
console.log(error2.message);  // "Account not found"
```

**æ–°å¢æ–‡æ¡£é“¾æ¥**:
- ğŸ“– [è¿è¡Œæ—¶å¤šè¯­è¨€æ”¯æŒ](./docs/runtime-locale-support.md)

---

### 4. ç”Ÿæˆæ·±åº¦åˆ†ææŠ¥å‘Š

**æ–‡ä»¶**: `reports/schema-dsl/analysis/deep-analysis-multilang-types-v1.1.2.md`

**æŠ¥å‘Šå†…å®¹**:
- âœ… å¤šè¯­è¨€åŠ è½½æœºåˆ¶è¯¦ç»†åˆ†æ
- âœ… string? è¯­æ³•æ”¯æŒéªŒè¯
- âœ… ç±»å‹å®šä¹‰é—®é¢˜åˆ†æä¸ä¿®å¤æ­¥éª¤
- âœ… æµ‹è¯•éªŒè¯ç»“æœ
- âœ… ä¼˜åŒ–å»ºè®®

**æ ¸å¿ƒå‘ç°**:
1. å¤šè¯­è¨€åŒ…åœ¨å¯åŠ¨æ—¶ä¸€æ¬¡æ€§åŠ è½½ï¼ˆ`lib/locales/index.js`ï¼‰
2. æ”¯æŒå…¨å±€åˆ‡æ¢ï¼š`Locale.setLocale('zh-CN')`
3. æ”¯æŒè¿è¡Œæ—¶æŒ‡å®šï¼š`dsl.error.create(code, params, statusCode, 'zh-CN')`
4. string? è¯­æ³•å®Œæ•´æ”¯æŒï¼ˆåŒ…æ‹¬ `string:3-32?`ã€`email?` ç­‰ï¼‰

---

## âœ… éªŒè¯æµ‹è¯•

### 1. å¤šè¯­è¨€æµ‹è¯•

**æµ‹è¯•æ–‡ä»¶**: `test-i18n-support.js`

**æµ‹è¯•è¦†ç›–**:
- âœ… dsl.error.create/throw/assert æ–¹æ³•å­˜åœ¨æ€§
- âœ… 5ç§è¯­è¨€æ”¯æŒéªŒè¯ï¼ˆä¸­è‹±æ—¥æ³•è¥¿ï¼‰
- âœ… å‚æ•°æ’å€¼åŠŸèƒ½
- âœ… è¿è¡Œæ—¶æŒ‡å®šè¯­è¨€ï¼ˆä¸å½±å“å…¨å±€ï¼‰
- âœ… é”™è¯¯å¯¹è±¡å±æ€§éªŒè¯
- âœ… toJSON æ–¹æ³•

**æµ‹è¯•ç»“æœ**:
```
========================================
  è¿è¡Œæ—¶è¯­è¨€æ”¯æŒæµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼
========================================
âœ… dsl.error.create æ”¯æŒè¿è¡Œæ—¶æŒ‡å®šè¯­è¨€
âœ… I18nError.throw æ”¯æŒè¿è¡Œæ—¶æŒ‡å®šè¯­è¨€
âœ… I18nError.assert æ”¯æŒè¿è¡Œæ—¶æŒ‡å®šè¯­è¨€
âœ… è¿è¡Œæ—¶è¯­è¨€ä¸å½±å“å…¨å±€è¯­è¨€è®¾ç½®
âœ… åŒä¸€è¯·æ±‚å¯ä½¿ç”¨å¤šç§è¯­è¨€
âœ… é€‚åˆ API å¼€å‘ä¸­æ ¹æ®è¯·æ±‚å¤´åŠ¨æ€è¿”å›å¤šè¯­è¨€é”™è¯¯

ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ctx.dsl.error ç­‰æ–¹æ³•å®Œå…¨æ”¯æŒå¤šè¯­è¨€ï¼
```

---

### 2. string? è¯­æ³•æµ‹è¯•

**æµ‹è¯•æ–‡ä»¶**: `test-optional-syntax.js`

**æµ‹è¯•è¦†ç›–**:
- âœ… `string`ï¼ˆé»˜è®¤å¯é€‰ï¼‰
- âœ… `string!`ï¼ˆå¿…å¡«ï¼‰
- âœ… `string?`ï¼ˆæ˜¾å¼å¯é€‰ï¼‰
- âœ… `string:3-32?`ï¼ˆèŒƒå›´å¯é€‰ï¼‰
- âœ… `email?`ï¼ˆæ ¼å¼å¯é€‰ï¼‰

**æµ‹è¯•ç»“æœ**:
```
========================================
  æµ‹è¯•æ€»ç»“
========================================
âœ… stringï¼ˆé»˜è®¤å¯é€‰ï¼‰- æ”¯æŒ
âœ… string!ï¼ˆå¿…å¡«ï¼‰- æ”¯æŒ
âœ… string?ï¼ˆæ˜¾å¼å¯é€‰ï¼‰- æ”¯æŒ

ğŸ¯ ç»“è®ºï¼š
  1. string å’Œ string? è¡Œä¸ºç›¸åŒï¼ˆéƒ½æ˜¯å¯é€‰ï¼‰
  2. string? æä¾›æ›´æ˜ç¡®çš„è¯­ä¹‰è¡¨è¾¾
  3. å»ºè®®ï¼šåœ¨éœ€è¦æ˜ç¡®è¡¨è¾¾"å¯é€‰"æ—¶ä½¿ç”¨ ?
```

---

### 3. ç±»å‹å®šä¹‰éªŒè¯

**å·¥å…·**: TypeScript ç¼–è¯‘å™¨ + IDE ç±»å‹æ£€æŸ¥

**éªŒè¯ç»“æœ**:
- âœ… æ— ç±»å‹é”™è¯¯
- âš ï¸ 2ä¸ªå¯å¿½ç•¥è­¦å‘Š
- âœ… dsl.error ç±»å‹å®Œæ•´
- âœ… I18nError ç±»å‹å®Œæ•´
- âœ… æ‰€æœ‰æ–¹æ³•ç­¾åæ­£ç¡®

---

## ğŸ”„ å†…éƒ¨æ”¹è¿›

### ç»Ÿä¸€ CHANGELOG.md æ ¼å¼

**å‚è€ƒ**: monSQLize/CHANGELOG.md

**æ”¹è¿›å†…å®¹**:
- âœ… è¯¦ç»†å˜æ›´ç§»è‡³ `changelogs/` ç›®å½•
- âœ… CHANGELOG.md ä¿ç•™ç‰ˆæœ¬æ¦‚è§ˆå’Œé‡Œç¨‹ç¢‘æ‘˜è¦
- âœ… å¢åŠ ç‰ˆæœ¬æ¦‚è§ˆè¡¨æ ¼
- âœ… å¢åŠ å˜æ›´ç»Ÿè®¡
- âœ… å¢åŠ é‡Œç¨‹ç¢‘ç‰ˆæœ¬æ‘˜è¦

**æ ¼å¼ç‰¹ç‚¹**:
- âœ… æ¸…æ™°çš„è¡¨æ ¼å¸ƒå±€
- âœ… ç»Ÿä¸€çš„æ—¥æœŸæ ¼å¼ï¼ˆYYYY-MM-DDï¼‰
- âœ… é‡è¦æ€§æ ‡è®°ï¼ˆâ­æ•°é‡ï¼‰
- âœ… Emoji å›¾æ ‡åˆ†ç±»ï¼ˆğŸ”§ğŸ›ğŸ‰ğŸ“šâœ…ï¼‰
- âœ… è¯¦ç»†é“¾æ¥åˆ° changelogs/ ç›®å½•

---

## ğŸ“¦ ä¾èµ–å˜æ›´

**æ— ä¾èµ–å˜æ›´**

---

## ğŸ¯ å‡çº§æŒ‡å—

### ä» v1.1.3 å‡çº§åˆ° v1.1.4

**ç ´åæ€§å˜æ›´**: âŒ æ— 

**æ¨èæ“ä½œ**:
```bash
npm install schema-dsl@1.1.4
```

**æ— éœ€ä¿®æ”¹ä»£ç **: æœ¬æ¬¡æ›´æ–°ä»…ä¿®å¤ TypeScript ç±»å‹å®šä¹‰ï¼Œä¸å½±å“è¿è¡Œæ—¶è¡Œä¸ºã€‚

---

## ğŸ“Š ç»Ÿè®¡ä¿¡æ¯

### ä»£ç å˜æ›´

| æ–‡ä»¶ | æ·»åŠ  | åˆ é™¤ | è¯´æ˜ |
|------|------|------|------|
| index.d.ts | 20 | 9 | ä¿®å¤é‡å¤ç­¾å + å®Œå–„æ³¨é‡Š |
| CHANGELOG.md | 150 | 1200 | æ ¼å¼é‡æ„ï¼Œè¯¦æƒ…ç§»è‡³ changelogs/ |
| README.md | 80 | 10 | æ·»åŠ è¿è¡Œæ—¶å¤šè¯­è¨€ç¤ºä¾‹ |
| STATUS.md | 30 | 10 | æ›´æ–°ç‰ˆæœ¬ä¿¡æ¯ |
| package.json | 1 | 1 | ç‰ˆæœ¬å·æ›´æ–° |
| changelogs/v1.1.4.md | 500 | 0 | æ–°å¢è¯¦ç»†å˜æ›´æ–‡æ¡£ |

### æ–‡æ¡£å®Œæ•´æ€§

- âœ… å¤šè¯­è¨€æ–‡æ¡£è¦†ç›–: 100%
- âœ… API æ–‡æ¡£å®Œæ•´æ€§: 100%
- âœ… ç¤ºä¾‹ä»£ç æ•°é‡: 15+
- âœ… æµ‹è¯•ç”¨ä¾‹æ•°é‡: 921

---

## ğŸ™ è‡´è°¢

æ„Ÿè°¢ monSQLize é¡¹ç›®å‘ç°å¹¶æŠ¥å‘Šç±»å‹å®šä¹‰é—®é¢˜ã€‚

---

## ğŸ”— ç›¸å…³é“¾æ¥

- [GitHub Repository](https://github.com/vextjs/schema-dsl)
- [npm Package](https://www.npmjs.com/package/schema-dsl)
- [å®Œæ•´æ–‡æ¡£](./docs/INDEX.md)
- [è¿è¡Œæ—¶å¤šè¯­è¨€æ”¯æŒ](./docs/runtime-locale-support.md)
- [å¤šè¯­è¨€ç”¨æˆ·æŒ‡å—](./docs/i18n-user-guide.md)

---

**å‘å¸ƒè€…**: schema-dsl Team  
**å‘å¸ƒæ—¶é—´**: 2026-01-13  
**ä¸‹ä¸€ç‰ˆæœ¬**: v1.1.5 (è®¡åˆ’ä¸­)

