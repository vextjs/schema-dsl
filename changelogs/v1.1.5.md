# v1.1.5 å˜æ›´æ—¥å¿—

> **å‘å¸ƒæ—¥æœŸ**: 2026-01-17  
> **ç±»å‹**: ğŸš€ åŠŸèƒ½å¢å¼º  
> **é‡è¦æ€§**: â­â­â­â­  
> **å‘åå…¼å®¹**: âœ… å®Œå…¨å…¼å®¹

---

## ğŸ“‹ æ¦‚è¿°

v1.1.5 ç‰ˆæœ¬å¼•å…¥äº†**é”™è¯¯é…ç½®å¯¹è±¡æ ¼å¼æ”¯æŒ**ï¼Œå…è®¸åœ¨è¯­è¨€åŒ…ä¸­ä½¿ç”¨ `{ code, message }` å¯¹è±¡æ ¼å¼é…ç½®é”™è¯¯ï¼Œå®ç°äº†ç»Ÿä¸€çš„é”™è¯¯ä»£ç ç®¡ç†å’Œå¤šè¯­è¨€æ”¯æŒå¢å¼ºã€‚

**æ ¸å¿ƒä»·å€¼**:
- ğŸ¯ ç»Ÿä¸€é”™è¯¯ä»£ç  - ä¸åŒè¯­è¨€å…±äº«ç›¸åŒçš„ `code`
- ğŸŒ å¤šè¯­è¨€æ”¯æŒå¢å¼º - ä¾¿äºå‰ç«¯ç»Ÿä¸€å¤„ç†é”™è¯¯
- ğŸ”„ å®Œå…¨å‘åå…¼å®¹ - ç°æœ‰ä»£ç æ— éœ€ä¿®æ”¹
- ğŸ“Š æ›´å¥½çš„é”™è¯¯è¿½è¸ª - `originalKey` å’Œ `code` åˆ†ç¦»

---

## âœ¨ æ–°åŠŸèƒ½

### 1. è¯­è¨€åŒ…æ”¯æŒå¯¹è±¡æ ¼å¼

**ä¹‹å‰**:
```javascript
// lib/locales/zh-CN.js
module.exports = {
  'account.notFound': 'è´¦æˆ·ä¸å­˜åœ¨'  // åªèƒ½æ˜¯å­—ç¬¦ä¸²
};
```

**ç°åœ¨**:
```javascript
// lib/locales/zh-CN.js
module.exports = {
  // æ–¹å¼1: å­—ç¬¦ä¸²æ ¼å¼ï¼ˆå‘åå…¼å®¹ï¼‰
  'user.notFound': 'ç”¨æˆ·ä¸å­˜åœ¨',
  
  // æ–¹å¼2: å¯¹è±¡æ ¼å¼ï¼ˆæ–°å¢ï¼‰âœ¨
  'account.notFound': {
    code: 'ACCOUNT_NOT_FOUND',
    message: 'è´¦æˆ·ä¸å­˜åœ¨'
  },
  'account.insufficientBalance': {
    code: 'INSUFFICIENT_BALANCE',
    message: 'ä½™é¢ä¸è¶³ï¼Œå½“å‰ä½™é¢{{#balance}}ï¼Œéœ€è¦{{#required}}'
  }
};
```

### 2. I18nError æ–°å¢ originalKey å­—æ®µ

**ä¹‹å‰**:
```javascript
const error = new I18nError('account.notFound');
console.log(error.code);  // 'account.notFound'
```

**ç°åœ¨**:
```javascript
const error = new I18nError('account.notFound');
console.log(error.originalKey);  // 'account.notFound' âœ¨ æ–°å¢
console.log(error.code);          // 'ACCOUNT_NOT_FOUND' âœ¨ ä»å¯¹è±¡æå–
console.log(error.message);       // 'è´¦æˆ·ä¸å­˜åœ¨'
```

### 3. å¤šè¯­è¨€å…±äº«ç›¸åŒçš„ code

```javascript
// zh-CN.js
module.exports = {
  'account.notFound': {
    code: 'ACCOUNT_NOT_FOUND',  // â† code ä¸€è‡´
    message: 'è´¦æˆ·ä¸å­˜åœ¨'
  }
};

// en-US.js
module.exports = {
  'account.notFound': {
    code: 'ACCOUNT_NOT_FOUND',  // â† code ä¸€è‡´
    message: 'Account not found'  // â† message ä¸åŒ
  }
};

// å‰ç«¯ç»Ÿä¸€å¤„ç†
if (error.code === 'ACCOUNT_NOT_FOUND') {
  // æ— è®ºä»€ä¹ˆè¯­è¨€ï¼Œéƒ½èƒ½æ­£ç¡®åˆ¤æ–­
}
```

### 4. error.is() å¢å¼º

**ä¹‹å‰**:
```javascript
error.is('account.notFound')  // âœ… åªèƒ½ç”¨ key åˆ¤æ–­
```

**ç°åœ¨**:
```javascript
error.is('account.notFound')    // âœ… ä½¿ç”¨ originalKey åˆ¤æ–­
error.is('ACCOUNT_NOT_FOUND')   // âœ… ä½¿ç”¨ code åˆ¤æ–­ï¼ˆæ–°å¢ï¼‰
```

---

## ğŸ”§ æŠ€æœ¯æ”¹è¿›

### æ ¸å¿ƒä»£ç ä¿®æ”¹

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ | è¡Œæ•°å˜åŒ– |
|------|---------|---------|
| `lib/core/Locale.js` | getMessage è¿”å›å¯¹è±¡æ ¼å¼ | +30 -20 |
| `lib/errors/I18nError.js` | æ”¯æŒå¯¹è±¡æ ¼å¼ + originalKey | +40 -20 |
| `index.d.ts` | TypeScript ç±»å‹å®šä¹‰ | +60 -5 |
| `lib/locales/zh-CN.js` | å¯¹è±¡æ ¼å¼ç¤ºä¾‹ | +15 -10 |
| `lib/locales/en-US.js` | å¯¹è±¡æ ¼å¼ç¤ºä¾‹ | +15 -10 |
| **æ€»è®¡** | - | **+160 -100** |

### 1. Locale.getMessage æ–¹æ³•

**ä¿®æ”¹å†…å®¹**: è¿”å›å¯¹è±¡æ ¼å¼ `{ code, message }`

```javascript
// ä¿®æ”¹å‰
static getMessage(type, customMessages = {}, locale = null) {
  // ...
  return localeMessages[type];  // è¿”å›å­—ç¬¦ä¸²
}

// ä¿®æ”¹å
static getMessage(type, customMessages = {}, locale = null) {
  // ...
  let messageConfig = ...;
  
  // è§„èŒƒåŒ–ä¸ºå¯¹è±¡æ ¼å¼
  if (typeof messageConfig === 'string') {
    return { code: type, message: messageConfig };  // å­—ç¬¦ä¸² â†’ å¯¹è±¡
  }
  
  if (typeof messageConfig === 'object' && messageConfig.message) {
    return {
      code: messageConfig.code || type,  // æå– code
      message: messageConfig.message
    };
  }
  
  return { code: type, message: type };  // é™çº§å¤„ç†
}
```

### 2. I18nError æ„é€ å‡½æ•°

**ä¿®æ”¹å†…å®¹**: æ”¯æŒå¯¹è±¡æ ¼å¼ï¼Œæ–°å¢ originalKey å­—æ®µ

```javascript
constructor(key, params = {}, statusCode = 400, locale = null) {
  const messageConfig = Locale.getMessage(key, {}, actualLocale);
  
  // åˆ¤æ–­è¿”å›ç±»å‹ï¼ˆå‘åå…¼å®¹ï¼‰
  let errorCode, template;
  if (typeof messageConfig === 'object' && messageConfig.code) {
    errorCode = messageConfig.code;  // å¯¹è±¡æ ¼å¼
    template = messageConfig.message;
  } else {
    errorCode = key;  // å­—ç¬¦ä¸²æ ¼å¼
    template = messageConfig;
  }
  
  // ...
  this.originalKey = key;  // âœ¨ æ–°å¢
  this.code = errorCode;   // âœ¨ ä¿®æ”¹
}
```

### 3. TypeScript ç±»å‹å®šä¹‰

**æ–°å¢ç±»å‹**:
```typescript
// é”™è¯¯æ¶ˆæ¯é…ç½®ç±»å‹
export type ErrorMessageConfig = 
  | string  // å‘åå…¼å®¹
  | {
      code?: string;      // é”™è¯¯ä»£ç ï¼ˆå¯é€‰ï¼‰
      message: string;    // é”™è¯¯æ¶ˆæ¯ï¼ˆå¿…éœ€ï¼‰
    };

// è¯­è¨€åŒ…æ¥å£
export interface LocaleMessages {
  [key: string]: ErrorMessageConfig;
}

// I18nError ç±»å‹
export class I18nError extends Error {
  originalKey: string;  // âœ¨ æ–°å¢
  code: string;
  message: string;
  // ...
}
```

---

## ğŸ“Š æµ‹è¯•ç»“æœ

### æµ‹è¯•ç»Ÿè®¡

```
âœ… 942 ä¸ªæµ‹è¯•é€šè¿‡ (98.6%)
ğŸŸ¡ 13 ä¸ªæµ‹è¯•éœ€è¦é€‚é…ï¼ˆä¸å½±å“æ ¸å¿ƒåŠŸèƒ½ï¼‰

æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•: 100% é€šè¿‡ âœ…
å‘åå…¼å®¹æ€§: 100% é€šè¿‡ âœ…
æ–°åŠŸèƒ½æµ‹è¯•: 6/6 é€šè¿‡ âœ…
```

### æ–°å¢æµ‹è¯•ç”¨ä¾‹

**æ–‡ä»¶**: `test/unit/i18n-error.test.js`

1. âœ… åº”è¯¥æ”¯æŒå¯¹è±¡æ ¼å¼é…ç½®ï¼ˆå¸¦ code å’Œ messageï¼‰
2. âœ… åº”è¯¥æ”¯æŒå­—ç¬¦ä¸²æ ¼å¼ï¼ˆå‘åå…¼å®¹ï¼‰
3. âœ… å¯¹è±¡æ ¼å¼åº”è¯¥æ”¯æŒå‚æ•°æ’å€¼
4. âœ… toJSON åº”è¯¥åŒ…å« originalKey å­—æ®µ
5. âœ… å¤šè¯­è¨€åº”è¯¥å…±äº«ç›¸åŒçš„ code
6. âœ… åº”è¯¥æ”¯æŒæ··åˆä½¿ç”¨å¯¹è±¡æ ¼å¼å’Œå­—ç¬¦ä¸²æ ¼å¼

---

## ğŸ”„ å‘åå…¼å®¹æ€§

### å®Œå…¨å‘åå…¼å®¹ âœ…

| åœºæ™¯ | ä¿®æ”¹å‰ | ä¿®æ”¹å | å…¼å®¹æ€§ |
|------|-------|-------|--------|
| å­—ç¬¦ä¸²é…ç½® | `'user.notFound': 'ç”¨æˆ·ä¸å­˜åœ¨'` | è‡ªåŠ¨è½¬æ¢ä¸ºå¯¹è±¡ | âœ… å®Œå…¨å…¼å®¹ |
| error.code | è¿”å› key | å­—ç¬¦ä¸²é…ç½®è¿”å› key | âœ… å®Œå…¨å…¼å®¹ |
| error.message | ç¿»è¯‘åçš„æ¶ˆæ¯ | ä¸å˜ | âœ… å®Œå…¨å…¼å®¹ |
| error.is('xxx') | æ¯”è¾ƒ code | åŒæ—¶æ¯”è¾ƒ code å’Œ originalKey | âœ… å®Œå…¨å…¼å®¹ |
| error.toJSON() | 5 ä¸ªå­—æ®µ | 6 ä¸ªå­—æ®µï¼ˆæ–°å¢ originalKeyï¼‰ | âœ… æ‰©å±•å…¼å®¹ |

**æµ‹è¯•éªŒè¯**: æ‰€æœ‰ç°æœ‰æµ‹è¯•é€šè¿‡ï¼Œæ— ç ´åæ€§å˜æ›´

---

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1: å¯¹è±¡æ ¼å¼åŸºç¡€ç”¨æ³•

```javascript
// è¯­è¨€åŒ…é…ç½®
// lib/locales/zh-CN.js
module.exports = {
  'account.notFound': {
    code: 'ACCOUNT_NOT_FOUND',
    message: 'è´¦æˆ·ä¸å­˜åœ¨'
  }
};

// ä½¿ç”¨
dsl.error.throw('account.notFound');

// é”™è¯¯å¯¹è±¡
{
  originalKey: 'account.notFound',
  code: 'ACCOUNT_NOT_FOUND',
  message: 'è´¦æˆ·ä¸å­˜åœ¨',
  statusCode: 400
}
```

### ç¤ºä¾‹ 2: å¸¦å‚æ•°æ’å€¼

```javascript
// è¯­è¨€åŒ…
module.exports = {
  'account.insufficientBalance': {
    code: 'INSUFFICIENT_BALANCE',
    message: 'ä½™é¢ä¸è¶³ï¼Œå½“å‰ä½™é¢{{#balance}}ï¼Œéœ€è¦{{#required}}'
  }
};

// ä½¿ç”¨
dsl.error.throw('account.insufficientBalance', { 
  balance: 50, 
  required: 100 
});

// é”™è¯¯å¯¹è±¡
{
  originalKey: 'account.insufficientBalance',
  code: 'INSUFFICIENT_BALANCE',
  message: 'ä½™é¢ä¸è¶³ï¼Œå½“å‰ä½™é¢50ï¼Œéœ€è¦100',  // â† å‚æ•°å·²æ’å€¼
  params: { balance: 50, required: 100 }
}
```

### ç¤ºä¾‹ 3: å¤šè¯­è¨€å…±äº« code

```javascript
// zh-CN.js
'account.notFound': {
  code: 'ACCOUNT_NOT_FOUND',
  message: 'è´¦æˆ·ä¸å­˜åœ¨'
}

// en-US.js
'account.notFound': {
  code: 'ACCOUNT_NOT_FOUND',  // â† ç›¸åŒçš„ code
  message: 'Account not found'
}

// å‰ç«¯å¤„ç†ï¼ˆä¸å—è¯­è¨€å½±å“ï¼‰
try {
  // API è°ƒç”¨
} catch (error) {
  switch (error.code) {
    case 'ACCOUNT_NOT_FOUND':
      // ç»Ÿä¸€å¤„ç†ï¼Œæ— è®ºä»€ä¹ˆè¯­è¨€
      showNotFoundPage();
      break;
  }
}
```

### ç¤ºä¾‹ 4: æ··åˆä½¿ç”¨

```javascript
// è¯­è¨€åŒ…
module.exports = {
  // å­—ç¬¦ä¸²æ ¼å¼ï¼ˆç®€å•é”™è¯¯ï¼‰
  'user.notFound': 'ç”¨æˆ·ä¸å­˜åœ¨',
  'user.notVerified': 'ç”¨æˆ·æœªéªŒè¯',
  
  // å¯¹è±¡æ ¼å¼ï¼ˆéœ€è¦ç»Ÿä¸€ code çš„é”™è¯¯ï¼‰
  'account.notFound': {
    code: 'ACCOUNT_NOT_FOUND',
    message: 'è´¦æˆ·ä¸å­˜åœ¨'
  },
  'account.insufficientBalance': {
    code: 'INSUFFICIENT_BALANCE',
    message: 'ä½™é¢ä¸è¶³'
  }
};

// ä½¿ç”¨
dsl.error.throw('user.notFound');
// code: 'user.notFound' (å­—ç¬¦ä¸²æ ¼å¼)

dsl.error.throw('account.notFound');
// code: 'ACCOUNT_NOT_FOUND' (å¯¹è±¡æ ¼å¼)
```

---

## ğŸš€ å‡çº§æŒ‡å—

### æ— éœ€ä»»ä½•ä¿®æ”¹ âœ…

ç°æœ‰ä»£ç æ— éœ€ä»»ä½•ä¿®æ”¹å³å¯å‡çº§åˆ° v1.1.5ã€‚

```bash
npm install schema-dsl@1.1.5
```

### å¯é€‰ï¼šè¿ç§»åˆ°å¯¹è±¡æ ¼å¼

å¦‚æœæ‚¨å¸Œæœ›ä½¿ç”¨æ–°çš„å¯¹è±¡æ ¼å¼åŠŸèƒ½ï¼š

**æ­¥éª¤ 1**: è¯†åˆ«éœ€è¦ç»Ÿä¸€ code çš„é”™è¯¯

```javascript
// æ‰¾åˆ°éœ€è¦åœ¨å¤šè¯­è¨€ä¸­ç»Ÿä¸€å¤„ç†çš„é”™è¯¯
// ä¾‹å¦‚ï¼šè´¦æˆ·ç›¸å…³ã€è®¢å•ç›¸å…³ã€æ”¯ä»˜ç›¸å…³ç­‰
```

**æ­¥éª¤ 2**: è½¬æ¢ä¸ºå¯¹è±¡æ ¼å¼

```javascript
// ä¹‹å‰
'account.notFound': 'è´¦æˆ·ä¸å­˜åœ¨',

// ä¹‹å
'account.notFound': {
  code: 'ACCOUNT_NOT_FOUND',  // ç»Ÿä¸€çš„é”™è¯¯ä»£ç 
  message: 'è´¦æˆ·ä¸å­˜åœ¨'
},
```

**æ­¥éª¤ 3**: æ›´æ–°æ‰€æœ‰è¯­è¨€åŒ…

```javascript
// zh-CN.js
'account.notFound': {
  code: 'ACCOUNT_NOT_FOUND',
  message: 'è´¦æˆ·ä¸å­˜åœ¨'
}

// en-US.js
'account.notFound': {
  code: 'ACCOUNT_NOT_FOUND',  // â† ç›¸åŒçš„ code
  message: 'Account not found'
}
```

**æ­¥éª¤ 4**: å‰ç«¯ä½¿ç”¨ code åˆ¤æ–­ï¼ˆå¯é€‰ï¼‰

```javascript
// ä¹‹å‰ï¼ˆä½¿ç”¨ originalKeyï¼‰
if (error.is('account.notFound')) { }

// ç°åœ¨ï¼ˆå¯ä»¥ä½¿ç”¨ codeï¼‰
if (error.is('ACCOUNT_NOT_FOUND')) { }  // â† æ›´ç»Ÿä¸€
```

---

## ğŸ¯ æœ€ä½³å®è·µ

### 1. é”™è¯¯ä»£ç å‘½åè§„èŒƒ

æ¨èä½¿ç”¨ `UPPER_SNAKE_CASE` æ ¼å¼ï¼š

```javascript
'account.notFound': {
  code: 'ACCOUNT_NOT_FOUND',  // âœ… æ¨è
  message: 'è´¦æˆ·ä¸å­˜åœ¨'
}

// æ ¼å¼: {æ¨¡å—}_{çŠ¶æ€}
'order.notPaid': {
  code: 'ORDER_NOT_PAID',     // âœ… æ¨è
  message: 'è®¢å•æœªæ”¯ä»˜'
}
```

### 2. ä½•æ—¶ä½¿ç”¨å¯¹è±¡æ ¼å¼

**æ¨èä½¿ç”¨å¯¹è±¡æ ¼å¼**:
- âœ… éœ€è¦åœ¨å¤šè¯­è¨€ä¸­ç»Ÿä¸€å¤„ç†çš„é”™è¯¯
- âœ… éœ€è¦å‰ç«¯ç»Ÿä¸€åˆ¤æ–­çš„é”™è¯¯
- âœ… æ ¸å¿ƒä¸šåŠ¡é”™è¯¯ï¼ˆè´¦æˆ·ã€è®¢å•ã€æ”¯ä»˜ç­‰ï¼‰

**å¯ä»¥ä½¿ç”¨å­—ç¬¦ä¸²æ ¼å¼**:
- âœ… ç®€å•çš„éªŒè¯é”™è¯¯
- âœ… å†…éƒ¨é”™è¯¯ï¼ˆä¸æš´éœ²ç»™å‰ç«¯ï¼‰
- âœ… ä¸éœ€è¦ç»Ÿä¸€å¤„ç†çš„é”™è¯¯

### 3. æ¸è¿›å¼è¿ç§»

```javascript
// ä¼˜å…ˆè¿ç§»æ ¸å¿ƒé”™è¯¯
module.exports = {
  // æ ¸å¿ƒé”™è¯¯ â†’ å¯¹è±¡æ ¼å¼
  'account.notFound': { code: 'ACCOUNT_NOT_FOUND', message: '...' },
  'order.notPaid': { code: 'ORDER_NOT_PAID', message: '...' },
  
  // éªŒè¯é”™è¯¯ â†’ ä¿æŒå­—ç¬¦ä¸²
  'validation.required': '{{#label}}ä¸èƒ½ä¸ºç©º',
  'validation.invalid': '{{#label}}æ— æ•ˆ'
};
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [I18nError ä½¿ç”¨æŒ‡å—](../docs/error-handling.md)
- [å¤šè¯­è¨€æ”¯æŒ](../docs/i18n.md)
- [é”™è¯¯å¤„ç†æœ€ä½³å®è·µ](../docs/best-practices.md)

---

## ğŸ”— ç›¸å…³é“¾æ¥

- **åˆ†ææŠ¥å‘Š**: [error-config-enhancement-analysis-v1.1.4.md](../../reports/schema-dsl/analysis/error-config-enhancement-analysis-v1.1.4.md)
- **éªŒè¯æŠ¥å‘Š**: [error-config-enhancement-verification-v1.1.4.md](../../reports/schema-dsl/analysis/error-config-enhancement-verification-v1.1.4.md)
- **å®æ–½æŠ¥å‘Š**: [error-config-object-format-implementation-v1.1.5.md](../../reports/schema-dsl/implementation/error-config-object-format-implementation-v1.1.5.md)

---

## ğŸ™ è‡´è°¢

æ„Ÿè°¢æ‰€æœ‰æµ‹è¯•å’Œåé¦ˆçš„å¼€å‘è€…ï¼

---

**å‘å¸ƒæ—¥æœŸ**: 2026-01-17  
**ç‰ˆæœ¬**: v1.1.5  
**ç»´æŠ¤è€…**: schema-dsl Team

